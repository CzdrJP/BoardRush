local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local StarterGui = game:GetService("StarterGui")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- -------------------------------------------------------------------------
-- Phase 0: å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯ã¨é‡è¤‡æ’é™¤
-- -------------------------------------------------------------------------

-- 1. é‡è¤‡ItemsGuiã®ãƒã‚§ãƒƒã‚¯
local guis = {}
for _, child in ipairs(playerGui:GetChildren()) do
	if child.Name == "ItemsGui" then
		table.insert(guis, child)
	end
end

if #guis > 1 then
	warn("[ItemsClient] PlayerGuiå†…ã«è¤‡æ•°ã®ItemsGuiã‚’æ¤œçŸ¥ã—ã¾ã—ãŸï¼é‡è¤‡ã‚’å‰Šé™¤ã—ã¾ã™ã€‚")
	-- è‡ªåˆ†è‡ªèº«ï¼ˆã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ç¥–å…ˆï¼‰ã‚’ç‰¹å®š
	local myGui = script:FindFirstAncestor("ItemsGui")
	for _, g in ipairs(guis) do
		if g ~= myGui then
			g:Destroy()
			warn("[ItemsClient] é‡è¤‡ã—ãŸItemsGuiã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚")
		end
	end
end

-- 2. ä¾å­˜é–¢ä¿‚ã®ä¿è­·
local function safeWaitFor(parent, name, timeout)
	local obj = parent:WaitForChild(name, timeout)
	if not obj then
		warn(string.format("[ItemsClient] %.1fç§’ä»¥å†…ã« %s ãŒ %s å†…ã«è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚", timeout, name, parent.Name))
	end
	return obj
end

local Shared = safeWaitFor(ReplicatedStorage, "Shared", 5)
local Remotes = safeWaitFor(ReplicatedStorage, "Remotes", 5)

if not Shared or not Remotes then
	warn("[ItemsClient] é‡å¤§: ä¾å­˜é–¢ä¿‚ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚UIã¯è¡¨ç¤ºã•ã‚Œã¾ã™ãŒæ©Ÿèƒ½ã—ã¾ã›ã‚“ã€‚")
end

local EquipmentConstants = nil
if Shared then
	local module = safeWaitFor(Shared, "EquipmentConstants", 5)
	if module then
		EquipmentConstants = require(module)
	end
end

local RequestEquipEvent = nil
if Remotes and EquipmentConstants then
	local equipmentRemotes = safeWaitFor(Remotes, "Equipment", 5)
	if equipmentRemotes then
		RequestEquipEvent = safeWaitFor(equipmentRemotes, EquipmentConstants.REMOTE_EVENT_NAME, 5)
	end
end

-- -------------------------------------------------------------------------
-- UIæ§‹ç¯‰ (Pop & Dynamic Design)
-- -------------------------------------------------------------------------
local ScreenGui = script.Parent

-- æ—¢å­˜UIãŒã‚ã‚Œã°å‰Šé™¤ï¼ˆãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã®é‡è¤‡é˜²æ­¢ï¼‰
if ScreenGui:FindFirstChild("MainFrame") then ScreenGui.MainFrame:Destroy() end
if ScreenGui:FindFirstChild("OpenButton") then ScreenGui.OpenButton:Destroy() end

local function addHoverAnimation(guiObject, scaleTarget)
	scaleTarget = scaleTarget or 1.05
	local originalSize = guiObject.Size
	
	guiObject.MouseEnter:Connect(function()
		TweenService:Create(guiObject, TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
			Size = UDim2.new(originalSize.X.Scale, originalSize.X.Offset * scaleTarget, originalSize.Y.Scale, originalSize.Y.Offset * scaleTarget)
		}):Play()
	end)
	
	guiObject.MouseLeave:Connect(function()
		TweenService:Create(guiObject, TweenInfo.new(0.25, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
			Size = originalSize
		}):Play()
	end)
end

-- ã€Œã‚¢ã‚¤ãƒ†ãƒ ã€ãƒœã‚¿ãƒ³ï¼ˆç”»é¢å³ä¸‹ï¼‰
local openButton = Instance.new("TextButton")
openButton.Name = "OpenButton"
openButton.Size = UDim2.new(0, 140, 0, 50)
openButton.Position = UDim2.new(1, -160, 0.9, -30)
openButton.AnchorPoint = Vector2.new(0.5, 0.5)
openButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
openButton.TextColor3 = Color3.fromRGB(50, 150, 255)
openButton.Font = Enum.Font.GothamBlack
openButton.TextSize = 20
openButton.Text = "ğŸ‘œ ITEMS"
openButton.AutoButtonColor = false
openButton.Parent = ScreenGui

local openCorner = Instance.new("UICorner", openButton)
openCorner.CornerRadius = UDim.new(0, 8)

local openStroke = Instance.new("UIStroke", openButton)
openStroke.Color = Color3.fromRGB(200, 220, 255)
openStroke.Thickness = 3
openStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

addHoverAnimation(openButton, 1.08)

-- ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ  (ä¸¸ã¿ã‚’å¸¯ã³ãŸãƒãƒƒãƒ—ãªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦)
local mainFrame = Instance.new("CanvasGroup")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 540, 0, 420) -- æ¨ªå¹…ã‚’540ã«æ‹¡å¼µ (110*4 + 15*3 + ãƒãƒ¼ã‚¸ãƒ³)
mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.BackgroundColor3 = Color3.fromRGB(250, 250, 255)
mainFrame.BorderSizePixel = 0
mainFrame.Visible = false
mainFrame.GroupTransparency = 1 
mainFrame.Parent = ScreenGui

local uiScale = Instance.new("UIScale", mainFrame)
uiScale.Scale = 0

local mainCorner = Instance.new("UICorner", mainFrame)
mainCorner.CornerRadius = UDim.new(0, 8)

local mainStroke = Instance.new("UIStroke", mainFrame)
mainStroke.Color = Color3.fromRGB(220, 220, 240)
mainStroke.Thickness = 4

local titleLabel = Instance.new("TextLabel")
titleLabel.Name = "TitleLabel"
titleLabel.Size = UDim2.new(1, -100, 0, 60)
titleLabel.Position = UDim2.new(0, 25, 0, 5)
titleLabel.BackgroundTransparency = 1
titleLabel.TextColor3 = Color3.fromRGB(60, 60, 80)
titleLabel.Font = Enum.Font.GothamBlack
titleLabel.TextSize = 26
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Text = "Your Items"
titleLabel.Parent = mainFrame

local closeButton = Instance.new("TextButton")
closeButton.Name = "CloseButton"
closeButton.Size = UDim2.new(0, 40, 0, 40)
closeButton.Position = UDim2.new(1, -30, 0, 15)
closeButton.AnchorPoint = Vector2.new(0.5, 0)
closeButton.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.Font = Enum.Font.GothamBlack
closeButton.TextSize = 20
closeButton.Text = "X"
closeButton.AutoButtonColor = false
closeButton.Parent = mainFrame
local closeCorner = Instance.new("UICorner", closeButton)
closeCorner.CornerRadius = UDim.new(0, 6)
addHoverAnimation(closeButton, 1.15)

local container = Instance.new("ScrollingFrame")
container.Name = "Container"
container.Size = UDim2.new(1, -30, 1, -80)
container.Position = UDim2.new(0, 15, 0, 65)
container.BackgroundTransparency = 1
container.CanvasSize = UDim2.new(0, 0, 0, 0)
container.AutomaticCanvasSize = Enum.AutomaticSize.Y
container.ScrollBarThickness = 8
container.ScrollBarImageColor3 = Color3.fromRGB(200, 200, 220)
container.Parent = mainFrame

local uiLayout = Instance.new("UIGridLayout")
uiLayout.Parent = container
uiLayout.SortOrder = Enum.SortOrder.LayoutOrder
uiLayout.CellPadding = UDim2.new(0, 15, 0, 15)
uiLayout.CellSize = UDim2.new(0, 110, 0, 145)
uiLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

local function createItemEntry(itemId, itemName)
	local containerFrame = Instance.new("Frame")
	containerFrame.Name = itemId
	containerFrame.BackgroundTransparency = 1
	containerFrame.Parent = container

	local actionButton = Instance.new("TextButton")
	actionButton.Name = "ActionButton"
	actionButton.Size = UDim2.new(1, 0, 0, 110)
	actionButton.BackgroundColor3 = Color3.fromRGB(245, 245, 255)
	actionButton.Text = ""
	actionButton.AutoButtonColor = false
	actionButton.Parent = containerFrame

	local corner = Instance.new("UICorner", actionButton)
	corner.CornerRadius = UDim.new(0, 12)
	
	local stroke = Instance.new("UIStroke", actionButton)
	stroke.Color = Color3.fromRGB(220, 220, 235)
	stroke.Thickness = 3
	
	local emoji = Instance.new("TextLabel", actionButton)
	emoji.Size = UDim2.new(1, 0, 1, 0)
	emoji.BackgroundTransparency = 1
	emoji.Text = "ğŸ›¹"
	emoji.TextSize = 56

	local nameLabel = Instance.new("TextLabel")
	nameLabel.Name = "NameLabel"
	nameLabel.Size = UDim2.new(1, 0, 0, 25)
	nameLabel.Position = UDim2.new(0, 0, 0, 120)
	nameLabel.BackgroundTransparency = 1
	nameLabel.TextColor3 = Color3.fromRGB(80, 80, 100)
	nameLabel.Font = Enum.Font.GothamBold
	nameLabel.TextSize = 14
	nameLabel.TextWrapped = true
	nameLabel.TextScaled = true
	nameLabel.TextXAlignment = Enum.TextXAlignment.Center
	nameLabel.Text = itemName
	nameLabel.Parent = containerFrame

	local equipBadge = Instance.new("Frame")
	equipBadge.Name = "EquipBadge"
	equipBadge.Size = UDim2.new(1, -20, 0, 24)
	equipBadge.AnchorPoint = Vector2.new(0.5, 1)
	equipBadge.Position = UDim2.new(0.5, 0, 1, -10)
	equipBadge.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
	equipBadge.Visible = false
	equipBadge.Parent = actionButton
	
	local badgeCorner = Instance.new("UICorner", equipBadge)
	badgeCorner.CornerRadius = UDim.new(0, 8)
	
	local badgeText = Instance.new("TextLabel", equipBadge)
	badgeText.Size = UDim2.new(1, 0, 1, 0)
	badgeText.BackgroundTransparency = 1
	badgeText.TextColor3 = Color3.fromRGB(255, 255, 255)
	badgeText.Font = Enum.Font.GothamBlack
	badgeText.TextSize = 12
	badgeText.Text = "EQUIPPED"

	addHoverAnimation(actionButton, 1.05)

	return containerFrame, actionButton, stroke, equipBadge
end

-- -------------------------------------------------------------------------
-- UI ãƒ­ã‚¸ãƒƒã‚¯
-- -------------------------------------------------------------------------

local isOpen = false

local function toggleUI()
	isOpen = not isOpen
	if isOpen then
		mainFrame.Visible = true
		mainFrame.Position = openButton.Position
		uiScale.Scale = 0
		
		TweenService:Create(mainFrame, TweenInfo.new(0.35, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
			Position = UDim2.new(0.5, 0, 0.5, 0),
			GroupTransparency = 0
		}):Play()
		TweenService:Create(uiScale, TweenInfo.new(0.35, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
			Scale = 1
		}):Play()
	else
		local closeTween = TweenService:Create(mainFrame, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
			Position = openButton.Position,
			GroupTransparency = 1
		})
		local scaleTween = TweenService:Create(uiScale, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
			Scale = 0
		})
		closeTween:Play()
		scaleTween:Play()
		closeTween.Completed:Connect(function()
			if not isOpen then mainFrame.Visible = false end
		end)
	end
end

openButton.MouseButton1Click:Connect(toggleUI)
closeButton.MouseButton1Click:Connect(toggleUI)

local boardButtons = {}

if EquipmentConstants and EquipmentConstants.BOARD_LIST then
	for _, boardInfo in ipairs(EquipmentConstants.BOARD_LIST) do
		local displayName = boardInfo.displayName
		local isUnlocked = player:GetAttribute(EquipmentConstants.ATTR_UNLOCKED_PREFIX .. boardInfo.id)
		
		if isUnlocked then
			local itemFrame, actionBtn, stroke, badge = createItemEntry(boardInfo.id, displayName)
			boardButtons[boardInfo.id] = { frame = itemFrame, button = actionBtn, stroke = stroke, badge = badge, info = boardInfo }
			
			actionBtn.MouseButton1Click:Connect(function()
				if RequestEquipEvent then
					RequestEquipEvent:FireServer(boardInfo.id)
				end
			end)
		end
	end
else
	local skateboardId = "Skateboard"
	if EquipmentConstants then
		skateboardId = EquipmentConstants.DEFAULT_BOARD_NAME or "Skateboard"
	end
	local _, actionBtn, stroke, badge = createItemEntry(skateboardId, skateboardId)
	boardButtons[skateboardId] = { button = actionBtn, stroke = stroke, badge = badge }
	actionBtn.MouseButton1Click:Connect(function()
		if RequestEquipEvent then RequestEquipEvent:FireServer(skateboardId) end
	end)
end

-- ãƒœã‚¿ãƒ³çŠ¶æ…‹ã®æ›´æ–°
local function updateButtonState()
	if not EquipmentConstants then return end
	local equippedId = player:GetAttribute(EquipmentConstants.ATTR_EQUIPPED_ID)

	for boardId, entry in pairs(boardButtons) do
		if equippedId == boardId then
			entry.stroke.Color = Color3.fromRGB(50, 220, 100) -- Green
			entry.stroke.Thickness = 4
			entry.badge.Visible = true
		else
			entry.stroke.Color = Color3.fromRGB(220, 220, 235)
			entry.stroke.Thickness = 3
			entry.badge.Visible = false
		end
	end
end

-- åˆæœŸãƒã‚§ãƒƒã‚¯
updateButtonState()

-- å±æ€§å¤‰æ›´ã®ç›£è¦–
player.AttributeChanged:Connect(function(attributeName)
	if EquipmentConstants and (
		attributeName == EquipmentConstants.ATTR_IS_EQUIPPED or 
		attributeName == EquipmentConstants.ATTR_EQUIPPED_ID
	) then
		updateButtonState()
	elseif EquipmentConstants and string.find(attributeName, EquipmentConstants.ATTR_UNLOCKED_PREFIX) then
		-- ã‚¢ãƒ³ãƒ­ãƒƒã‚¯çŠ¶æ…‹ãŒå¤‰ã‚ã£ãŸã‚‰ãƒªã‚¹ãƒˆã‚’å†æ§‹ç¯‰
		for _, child in ipairs(container:GetChildren()) do
			if child:IsA("Frame") then child:Destroy() end
		end
		boardButtons = {}
		
		for _, boardInfo in ipairs(EquipmentConstants.BOARD_LIST) do
			local isUnlocked = player:GetAttribute(EquipmentConstants.ATTR_UNLOCKED_PREFIX .. boardInfo.id)
			if isUnlocked then
				local itemFrame, actionBtn, stroke, badge = createItemEntry(boardInfo.id, boardInfo.displayName)
				boardButtons[boardInfo.id] = { frame = itemFrame, button = actionBtn, stroke = stroke, badge = badge, info = boardInfo }
				actionBtn.MouseButton1Click:Connect(function()
					if RequestEquipEvent then RequestEquipEvent:FireServer(boardInfo.id) end
				end)
			end
		end
		updateButtonState()
	end
end)

print("[ItemsClient] åˆæœŸåŒ–æˆåŠŸ")

-- -------------------------------------------------------------------------
-- èµ°è¡ŒéŸ³ãƒŸãƒ¥ãƒ¼ãƒˆï¼ˆè£…å‚™ä¸­ã®ã¿ï¼‰
-- -------------------------------------------------------------------------
local savedRunningVolume = nil

local function updateRunningSound()
	if not EquipmentConstants then return end
	local isEquipped = player:GetAttribute(EquipmentConstants.ATTR_IS_EQUIPPED)
	local character = player.Character
	if not character then return end
	local hrp = character:FindFirstChild("HumanoidRootPart")
	if not hrp then return end
	local runningSound = hrp:FindFirstChild("Running")
	if not runningSound or not runningSound:IsA("Sound") then return end

	if isEquipped then
		if savedRunningVolume == nil then
			savedRunningVolume = runningSound.Volume
		end
		runningSound.Volume = 0
	else
		if savedRunningVolume ~= nil then
			runningSound.Volume = savedRunningVolume
			savedRunningVolume = nil
		end
	end
end

-- -------------------------------------------------------------------------
-- ãƒ©ã‚¤ãƒ‡ã‚£ãƒ³ã‚°ãƒãƒ¼ã‚ºï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼šã‚¢ã‚¤ãƒ‰ãƒ«ã‚¢ãƒ‹ãƒ¡å†ç”Ÿï¼‰
-- -------------------------------------------------------------------------
local idleTrack = nil

local function updateRidingPose()
	if not EquipmentConstants then return end
	local isEquipped = player:GetAttribute(EquipmentConstants.ATTR_IS_EQUIPPED)
	local character = player.Character
	if not character then return end
	local humanoid = character:FindFirstChildOfClass("Humanoid")
	local animate = character:FindFirstChild("Animate")

	if isEquipped then
		-- Animateç„¡åŠ¹åŒ–ï¼ˆèµ°ã‚Šãƒ»ã‚¸ãƒ£ãƒ³ãƒ—ç­‰ã‚’åœæ­¢ï¼‰
		if animate then
			animate.Disabled = true
		end

		-- å…¨AnimationTrackåœæ­¢
		if humanoid then
			local animator = humanoid:FindFirstChildOfClass("Animator")
			if animator then
				for _, track in ipairs(animator:GetPlayingAnimationTracks()) do
					track:Stop(0)
				end

				-- Animateã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã‹ã‚‰ã‚¢ã‚¤ãƒ‰ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³IDã‚’å–å¾—
				local idleAnim = nil
				if animate then
					local idleFolder = animate:FindFirstChild("idle")
					if idleFolder then
						local anim = idleFolder:FindFirstChildOfClass("Animation")
						if anim then
							idleAnim = anim
						end
					end
				end

				-- ã‚¢ã‚¤ãƒ‰ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†ç”Ÿ
				if idleAnim then
					idleTrack = animator:LoadAnimation(idleAnim)
					idleTrack.Looped = true
					idleTrack.Priority = Enum.AnimationPriority.Movement
					idleTrack:Play()
				end
			end
		end
	else
		-- ã‚¢ã‚¤ãƒ‰ãƒ«ãƒˆãƒ©ãƒƒã‚¯åœæ­¢
		if idleTrack then
			idleTrack:Stop(0)
			idleTrack:Destroy()
			idleTrack = nil
		end

		-- Animateå¾©å…ƒ
		if animate then
			animate.Disabled = false
		end
	end
end

-- -------------------------------------------------------------------------
-- åŠ é€Ÿåº¦æ–¹å¼ã®ç§»å‹•é€Ÿåº¦ã‚·ã‚¹ãƒ†ãƒ ï¼ˆè£…å‚™ä¸­ã®ã¿ï¼‰
-- -------------------------------------------------------------------------
local RunService = game:GetService("RunService")
local ACCEL_TIME = 2.0  -- 0â†’1 ã¾ã§ã®ç§’æ•°
local DECEL_TIME = 1.3  -- 1â†’0 ã¾ã§ã®ç§’æ•°
local speedFactor = 0
local accelConnection = nil

local function startAcceleration()
	if accelConnection then accelConnection:Disconnect() end
	speedFactor = 0
	local lastVelocity = Vector3.zero

	accelConnection = RunService.Heartbeat:Connect(function(dt)
		local character = player.Character
		if not character then return end
		local humanoid = character:FindFirstChildOfClass("Humanoid")
		local hrp = character:FindFirstChild("HumanoidRootPart")
		if not humanoid or not hrp then return end

		local maxSpeed = player:GetAttribute("MaxWalkSpeed") or 32
		local moveDir = humanoid.MoveDirection
		local isMoving = moveDir.Magnitude > 0.01

		if isMoving then
			-- åŠ é€Ÿãƒ•ã‚§ãƒ¼ã‚º: WalkSpeedã§é€šå¸¸ç§»å‹•
			speedFactor = math.min(1, speedFactor + dt / ACCEL_TIME)
			humanoid.WalkSpeed = maxSpeed * speedFactor
			-- ç¾åœ¨ã®æ°´å¹³é€Ÿåº¦ã‚’è¨˜éŒ²ï¼ˆæ…£æ€§ç”¨ï¼‰
			local vel = hrp.AssemblyLinearVelocity
			lastVelocity = Vector3.new(vel.X, 0, vel.Z)
		else
			if speedFactor > 0 then
				-- æ¸›é€Ÿãƒ•ã‚§ãƒ¼ã‚º: WalkSpeed=0ã«ã—ã¦HRPé€Ÿåº¦ã‚’ç›´æ¥åˆ¶å¾¡
				speedFactor = math.max(0, speedFactor - dt / DECEL_TIME)
				humanoid.WalkSpeed = 0
				-- æ…£æ€§: æœ€å¾Œã®é€Ÿåº¦ã‚’å¾ã€…ã«æ¸›è¡°
				local ratio = speedFactor / 1 -- ç¾åœ¨ã®æ¸›è¡°ç‡
				local targetVel = lastVelocity * ratio
				hrp.AssemblyLinearVelocity = Vector3.new(
					targetVel.X,
					hrp.AssemblyLinearVelocity.Y, -- Y(é‡åŠ›)ã¯ç¶­æŒ
					targetVel.Z
				)
			else
				humanoid.WalkSpeed = 0
			end
		end
	end)
end

local function stopAcceleration()
	if accelConnection then
		accelConnection:Disconnect()
		accelConnection = nil
	end
	speedFactor = 0
end

-- -------------------------------------------------------------------------
-- ã‚¤ãƒ™ãƒ³ãƒˆæ¥ç¶š
-- -------------------------------------------------------------------------
player.AttributeChanged:Connect(function(attributeName)
	if EquipmentConstants and attributeName == EquipmentConstants.ATTR_IS_EQUIPPED then
		task.defer(updateRunningSound)
		task.defer(updateRidingPose)
		-- åŠ é€Ÿåº¦ã‚·ã‚¹ãƒ†ãƒ 
		local isEquipped = player:GetAttribute(EquipmentConstants.ATTR_IS_EQUIPPED)
		if isEquipped then
			task.defer(startAcceleration)
		else
			stopAcceleration()
		end
	end
end)

player.CharacterAdded:Connect(function(character)
	character:WaitForChild("HumanoidRootPart", 5)
	task.wait(0.5)
	updateRunningSound()
	updateRidingPose()
	-- ãƒªã‚¹ãƒãƒ¼ãƒ³æ™‚ã¯åŠ é€Ÿåº¦ã‚‚åœæ­¢
	stopAcceleration()
end)

